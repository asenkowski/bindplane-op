---
apiVersion: bindplane.observiq.com/v1beta
kind: Exporter
metadata:
  name: cabin-production-logs
spec:
  # we will need additional plugins for metrics, traces, etc
  plugin:
    name: cabin_output

  # can be generated by web ui
  parameters:
    - name: endpoint
      value: https://nozzle.app.observiq.com
    - name: secret_key
      value: 2c088c5e-2afc-483b-be52-e2b657fcff08
      # valueFrom:
      #   secretKeyRef:
      #     name: bindplane
      #     key: secret_key
      #   bindplaneKeyRef:
      #     key: secret_key
    - name: timeout
      value: 10s
---
apiVersion: bindplane.observiq.com/v1beta
kind: Receiver
metadata:
  name: macOS
spec:
  plugin:
    name: macos
  parameters:
    - name: name
      value: macOS
    - name: version
      value: "0.0.2"
    - name: start_at
      value: end
    - name: enable_system_log
      value: true
    - name: enable_install_log
      value: true
---
apiVersion: bindplane.observiq.com/v1beta
kind: Receiver
metadata:
  name: production-nginx-ingress
  labels:
    app: nginx
spec:
  plugin:
    name: nginx_ingress
  parameters:
    - name: log_format
      value: default
    - name: cluster_name
      value: minikube
    - name: pod_name
      value: nginx-ingress
    - name: container_name
      value: "*"
    - name: enable_access_log
      value: true
    - name: enable_error_log
      value: true
    - name: start_at
      value: end
---
apiVersion: bindplane.observiq.com/v1beta
kind: Pipeline
metadata:
  name: cabin production pipeline
  labels:
    app: cabin
spec:
  pipeline:
    receivers:
      - production-nginx-ingress
    processors:
    exporters:
      - cabin-production-logs
  # agents with labels "app=cabin" and "env=production" will use this exporter
  selector:
    matchLabels:
      app: cabin
      env: production
      # platform: kubernetes
      # cluster: cabin-production
